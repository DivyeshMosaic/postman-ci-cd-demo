name: Auto Sync + Run Postman Collection

on:
  push:
    branches:
      - main
  schedule:
    - cron: "0 */6 * * *" # run every 6 hours (optional)
  workflow_dispatch:       # manual trigger

jobs:
  run-postman:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Install Postman CLI
      run: |
        curl -o- "https://dl-cli.pstmn.io/install/linux64.sh" | sh

    - name: Fetch latest collection JSON from Postman
      run: |
        curl -X GET \
        "https://api.postman.com/collections/${{ secrets.POSTMAN_COLLECTION_ID }}" \
        -H "X-Api-Key: ${{ secrets.POSTMAN_API_KEY }}" \
        | jq '.collection' > latest_collection.json

    - name: Run Postman Collection via Postman CLI
      run: |
        postman collection run latest_collection.json

